<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebWatcher Subscription</title>
</head>
<body>
    <form id="userForm">
        Email: <input type="email" id="email" required><br>
        Business Website URL: <input type="url" id="website" required><br>
        <div id="paypal-button-container"></div>
    </form>

    <script src="https://www.paypal.com/sdk/js?client-id=AQtmB7n30XzehoP2DAC06-Pj3jHs-iC1dJ9i59j0F-jeoRHvFOJqht0GUrBbe5zMwul-5MYBdXr6KvEv&vault=true&intent=subscription"></script>
    <script>
        paypal.Buttons({
            createSubscription: function(data, actions) {
                return actions.subscription.create({
                    'plan_id': 'P-1M441108AK5728351MV5EDSQ'
                });
            },
            onApprove: function(data, actions) {
                const email = document.getElementById('email').value;
                const website = document.getElementById('website').value;

                fetch('http://localhost:3000/process-subscription', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, website, subscriptionId: data.subscriptionID })
                })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Network response was not ok.');
                })
                .then(data => {
                    window.alert('Subscription successful! Thank you for your payment.');
                })
                .catch(error => {
                    window.alert('There was a problem with your subscription: ' + error.message);
                });
            },
            onCancel: function(data) {
                window.alert('Subscription cancelled.');
            },
            onError: function(err) {
                window.alert('An error occurred during the subscription process: ' + err);
            },
            style: {
                color: 'black'
            }
        }).render('#paypal-button-container');
    </script>
</body>
</html>
