<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Flashcards with Leaderboard and Management Modals</title>
    <style>
        /* Existing styles */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            overflow-x: hidden;
            display: flex;
        }
        h3 {
            margin-top:0px;
            margin-bottom:0px;
        }
        /* Add 100px margin-left if the viewport width is greater than 800px */
        @media screen and (min-width: 1001px) {
            body {
                margin-left: 100px;
            }
        }

        /* Remove margin-left if the viewport width is less than or equal to 800px */
        @media screen and (max-width: 1000px) {
            body {
                margin-left: 0px;
            }
        }
        .main-container {
            display: flex;
            margin-top: 50px;
        }
        .leaderboard {
            width: 250px;
            margin-right: 30px;
        }
        .leaderboard h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        .leaderboard .user {
            display: flex;
            align-items: center;
            background-color: #fff;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .leaderboard .user img {
            border-radius: 50%;
            width: 50px;
            height: 50px;
            margin-right: 15px;
        }
        .leaderboard .user-info {
            flex: 1;
        }
        .leaderboard .username {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .leaderboard .points {
            color: #666;
        }
        .container {
            width: 600px;
            text-align: center;
            position: relative;
        }
        .collection-title {
            margin-top: 20px;
            margin-bottom: 40px;
        }
        /* Flashcard Styles */
        .flashcard-container {
            perspective: 1000px;
            width: 100%;
            margin: 0 auto 10px auto;
            position: relative;
        }
        .flashcard {
            position: relative;
            width: 100%;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .flashcard.is-flipped {
            transform: rotateX(180deg);
        }
        .flashcard-face {
            position: relative;
            width: 100%;
            backface-visibility: hidden;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            min-height: 200px;
        }
        .flashcard-face h2 {
            margin: 0;
        }
        .flashcard-front {
            transform: rotateX(0deg);
        }
        .flashcard-back {
            transform: rotateX(180deg);
            position: absolute;
            top: 0;
            left: 0;
        }
        /* Timer Styles */
        .timer {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 24px;
            font-weight: bold;
            display: none;
        }
        /* Button Styles */
        .buttons {
            margin-top: 10px;
            margin-bottom: 20px;
        }
        .buttons button {
            padding: 10px 20px;
            margin: 0 5px;
            border: none;
            border-radius: 5px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .buttons button:hover {
            background-color: #e0e0e0;
        }
        /* Comments Section Styles */
        .comments-section {
            width: 100%;
            margin: 0 auto;
            margin-bottom: 60px;
            position: relative;
            height: 400px;
            overflow: hidden;
        }
        .comment {
            display: flex;
            align-items: center;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 10px;
            margin-top: 10px;
            opacity: 1;
            animation: fadeOut 1s forwards;
            position: relative;
        }
        .comment.new-comment {
            animation: slideDown 0.5s ease-out;
        }
        .comment img {
            border-radius: 50%;
            width: 50px;
            height: 50px;
            margin-right: 15px;
        }
        .comment .comment-text {
            flex: 1;
            text-align: left;
        }
        .comment .username {
            font-weight: bold;
        }
        @keyframes fadeOut {
            0% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; transform: translateY(-20px); }
        }
        @keyframes slideDown {
            0% { opacity: 0; transform: translateY(-20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        /* Side Panel Styles */
        #sidepanel {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 2;
            top: 0;
            right: 0;
            background-color: #fff;
            overflow-x: hidden;
            transition: 0.5s;
            box-shadow: -2px 0 5px rgba(0,0,0,0.2);
            padding-top: 60px;
        }
        #sidepanel .closebtn {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
            color: #000;
            cursor: pointer;
        }
        #sidepanel h2 {
            text-align: center;
            margin-bottom: 30px;
        }
        #collectionsList {
            list-style-type: none;
            padding: 0;
        }
        #collectionsList li {
            padding: 15px;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
        }
        #collectionsList li:hover {
            background-color: #f1f1f1;
        }
        #sidepanel .enter-username,
        #sidepanel .add-collection,
        #sidepanel .add-card,
        #sidepanel .manage-collection,
        #sidepanel .manage-card,
        #sidepanel .simulate-comments,
        #sidepanel .adjust-timer,
        #sidepanel .add-user,
        #sidepanel .clear-leaderboard {
            display: flex;
            flex-direction: column;
            padding: 20px;
            padding-bottom:0px;
        }
        #sidepanel .manage-collection,
        #sidepanel .manage-card {
            padding-top:0px;
        }
        #sidepanel .clear-leaderboard {
            margin-bottom: 100px;
        }
        #sidepanel input,
        #sidepanel button {
            margin: 10px 0;
            padding: 10px;
        }
        .openbtn {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 20px;
            background-color: #fff;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1;
        }
        .openbtn:hover {
            background-color: #e0e0e0;
        }
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 3;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 100px auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 10px;
            position: relative;
        }
        .close-modal {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 25px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .modal h2 {
            margin-top: 0;
        }
        .modal ul {
            list-style-type: none;
            padding: 0;
        }
        .modal ul li {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal ul li:last-child {
            border-bottom: none;
        }
        .modal ul li button {
            padding: 5px 10px;
            margin-left: 10px;
        }
        /* New Styles for JSON Upload */
        #jsonUploadContainer {
            margin-top: 20px;
        }
        #jsonUploadContainer textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            box-sizing: border-box;
        }
        #jsonUploadContainer button {
            margin-top: 10px;
        }
        .error-message {
            color: red;
            margin-top: 10px;
        }
        .success-message {
            color: green;
            margin-top: 10px;
        }
        /* New Styles for Enter Username */
        #sidepanel .enter-username input {
            margin: 10px 0;
            padding: 10px;
        }
        #sidepanel .enter-username button {
            margin: 10px 0;
            padding: 10px;
        }
        #manageCollectionsButton,
        #manageFlashcardsButton,
        #newAnswer {
            margin-top:0px !important;
        }
        /* Disable buttons when not allowed */
        .disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        .wavy-text {
            font-size: 2em;
            font-weight: bold;
            color: #5bc25f;
            animation: wave 1.5s ease-in-out infinite;
        }

        .wavy-text span {
            display: inline-block;
            animation: wave 1.5s ease-in-out infinite;
        }

        @keyframes wave {
            0%, 100% { transform: translateY(0); }
            25% { transform: translateY(-3px); }
            75% { transform: translateY(3px); }
        }

        .wavy-text span:nth-child(1) { animation-delay: 0s; }
        .wavy-text span:nth-child(2) { animation-delay: 0.1s; }
        .wavy-text span:nth-child(3) { animation-delay: 0.2s; }
        .wavy-text span:nth-child(4) { animation-delay: 0.3s; }
        .wavy-text span:nth-child(5) { animation-delay: 0.4s; }
        .wavy-text span:nth-child(6) { animation-delay: 0.5s; }
        .wavy-text span:nth-child(7) { animation-delay: 0.6s; }
        .wavy-text span:nth-child(8) { animation-delay: 0.7s; }
        .wavy-text span:nth-child(9) { animation-delay: 0.8s; }
        .wavy-text span:nth-child(10) { animation-delay: 0.9s; }
        .wavy-text span:nth-child(11) { animation-delay: 1.0s; }

        /* Hide arrows in number input for Chrome, Safari, Edge, and Opera */
        .no-arrows::-webkit-outer-spin-button,
        .no-arrows::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Hide arrows in number input for Firefox */
        .no-arrows[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body>

<div id="sidepanel">
    <a href="javascript:void(0)" class="closebtn" onclick="closeSidePanel()">&times;</a>
    <h2>Settings</h2>

    <!-- New TikTok Username Input -->
    <div class="enter-username">
        <h3>Enter Your TikTok Username</h3>
        <input type="text" id="tiktokUsernameInput" placeholder="TikTok Username">
        <button id="saveUsernameButton">Save Username</button>
    </div>

    <div class="adjust-timer">
        <h3>Adjust Round Duration</h3>
        <input type="number" id="roundDurationInput" placeholder="Seconds (e.g., 90)" min="1" value="90">
    </div>
    <div class="add-collection">
        <h3>Add New Collection</h3>
        <input type="text" id="newCollectionName" placeholder="Collection Name" disabled>
        <button id="addCollectionButton" onclick="addCollection()" disabled>Add Collection</button>
    </div>
    <div class="manage-collection">
        <button id="manageCollectionsButton" onclick="openManageCollectionsModal()" disabled>Manage Collections</button>
    </div>
    <div class="add-card">
        <h3>Add New Flashcard</h3>
        <input type="text" id="newPrompt" placeholder="Prompt" disabled>
        <input type="text" id="newAnswer" placeholder="Answer" disabled>
        <button id="addFlashcardButton" onclick="addFlashcard()" disabled>Add Flashcard</button>
    </div>
    <div class="manage-card">
        <button id="manageFlashcardsButton" onclick="openManageFlashcardsModal()" disabled>Manage Flashcards</button>
    </div>
    <div class="simulate-comments">
        <h3>Simulate Comments</h3>
        <button onclick="simulateComments()">Add Comment</button>
    </div>
    <div class="add-user">
        <h3>Simulate User Answer</h3>
        <button onclick="simulateUserAnswer()">Simulate Correct Answer</button>
    </div>
    <div class="clear-leaderboard">
        <h3>Leaderboard Controls</h3>
        <button onclick="clearLeaderboard()">Clear Leaderboard</button>
    </div>
</div>

<button class="openbtn" onclick="openSidePanel()">&#9776;</button>

<!-- Modals -->
<!-- Manage Collections Modal -->
<div id="manageCollectionsModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeManageCollectionsModal()">&times;</span>
        <h2>Manage Collections</h2>
        <ul id="collectionsModalList">
            <!-- Collections will be listed here -->
        </ul>
    </div>
</div>

<!-- Manage Flashcards Modal -->
<div id="manageFlashcardsModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeManageFlashcardsModal()">&times;</span>
        <h2>Manage Flashcards in "<span id="currentCollectionName"></span>"</h2>
        <ul id="flashcardsModalList">
            <!-- Flashcards will be listed here -->
        </ul>
        <!-- JSON Upload Section -->
        <div id="jsonUploadContainer">
            <h3>Upload Flashcards via JSON</h3>
            <textarea id="jsonInput" placeholder='Paste JSON array here'></textarea>
            <button onclick="uploadFlashcardsFromJSON()">Upload Flashcards</button>
            <div id="jsonMessage"></div>
        </div>
    </div>
</div>

<div class="main-container">
    <!-- Leaderboard Section -->
    <div class="leaderboard" id="leaderboard">
        <h2 id="leaderboardTextContainer">
            <span>L</span><span>e</span><span>a</span><span>d</span><span>e</span><span>r</span><span>b</span><span>o</span><span>a</span><span>r</span><span>d</span>
        </h2>
        <!-- Users will be injected here -->
    </div>

    <!-- Flashcards Container -->
    <div class="container">
        <h1 class="collection-title" id="collectionTitle">Please Enter Username</h1>
        <div class="flashcard-container">
            <div class="flashcard" id="flashcard">
                <div class="flashcard-face flashcard-front">
                    <div class="timer" id="timerDisplay">90</div>
                    <h2 id="flashcardPrompt">No Flashcards Available</h2>
                </div>
                <div class="flashcard-face flashcard-back">
                    <h2 id="flashcardAnswer"></h2>
                </div>
            </div>
        </div>
        <div id="flashcardIndex" style="cursor:pointer;"></div>
        <div class="buttons">
            <button id="startRoundButton" onclick="startRound()">Start Round</button>
            <button id="previousButton" onclick="prevFlashcard()">Previous</button>
            <button id="revealButton" onclick="revealAnswer()">Reveal</button>
            <button id="nextButton" onclick="nextFlashcard()">Next</button>
        </div>
        <!-- Comments Section -->
        <div class="comments-section" id="commentsSection"></div>
        <h3 style="color:#757575">TikTok interactions powered by Chat Capture chrome extension</h3>
    </div>
</div>

<script>
    let collections = {}; // Collections will be fetched from the server
    let currentCollection = "";
    let currentIndex = 0;
    let showingAnswer = false;

    // Timer Variables
    let timerDuration = 90; // in seconds
    let timer;
    let remainingTime = timerDuration;
    let roundStartTime;
    let roundActive = false; // Indicates if a round is active

    // Leaderboard Data
    let leaderboardData = [];

    // Users who have answered correctly in the current round
    let usersAnsweredThisRound = new Set();

    // Comment Data for Testing
    const testComment = {
        photoUrl: ["data:image/jpeg;base64,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",
                    "https://i0.wp.com/picjumbo.com/wp-content/uploads/beautiful-autumn-nature-with-a-river-in-the-middle-of-the-forest-free-image.jpeg?w=600&quality=80",
                    "https://media.istockphoto.com/id/1170493702/photo/portrait-of-smiling-young-woman-looking-at-camera.jpg?s=612x612&w=0&k=20&c=2nS__ZCBvTLdbI96NDKLeaVNYcenc8Pg3o01PswHcXk=",
                    "https://media.istockphoto.com/id/1276778124/photo/beautiful-senior-woman-outdoors-in-the-city.jpg?s=612x612&w=0&k=20&c=J5iLFEF_pcztXZzCeYsphhjziA9VM9d7UZGAwNvcZu0=",
                    "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSpS4CstMwyiA-3QsCcpENY5DtlQM51AGxpag&s"],
        username: ["Bob", "Charlie", "Eve", "Dana", "Alice"],
        comments: [
            "We shower here",
            "Idk",
            "Worshire Here",
            "We showered there",
            "Wishy washy!"
        ]
    };

    // Variable to Store TikTok Username
    let tiktokUsername = '';

    // Disable input fields until username is saved
    function disableInputs(disable) {
        document.getElementById('newCollectionName').disabled = disable;
        document.getElementById('addCollectionButton').disabled = disable;
        document.getElementById('manageCollectionsButton').disabled = disable;
        document.getElementById('newPrompt').disabled = disable;
        document.getElementById('newAnswer').disabled = disable;
        document.getElementById('addFlashcardButton').disabled = disable;
        document.getElementById('manageFlashcardsButton').disabled = disable;
    }
    disableInputs(true); // Disable inputs initially

    // Event Listener for Save Username Button
    document.getElementById('saveUsernameButton').addEventListener('click', function() {
        const usernameInput = document.getElementById('tiktokUsernameInput').value.trim();
        if (usernameInput) {
            tiktokUsername = usernameInput;
            localStorage.setItem('tiktokUsername', tiktokUsername); // Store in localStorage
            disableInputs(false);
            fetchCollectionsAndFlashcards();
        } else {
            alert('Please enter your TikTok username.');
        }
    });

    function fetchCollectionsAndFlashcards() {
        // Fetch collections
        fetch('https://cc-contexto-d01a6bbfa039.herokuapp.com/get-collections?tiktok_username=' + encodeURIComponent(tiktokUsername))
        .then(response => response.json())
        .then(data => {
            // Assuming data.collections is an array of collection names
            if (Array.isArray(data.collections)) {
                collections = {};
                data.collections.forEach(collectionName => {
                    collections[collectionName] = []; // Initialize empty arrays for flashcards
                });
                // Now fetch flashcards
                fetchFlashcards();
            } else {
                console.error('Invalid data format for collections.');
            }
        })
        .catch(error => {
            window.alert(error)
            console.error('Error fetching collections:', error);
        });
    }

    function fetchFlashcards() {
        fetch('https://cc-contexto-d01a6bbfa039.herokuapp.com/get-flashcards?tiktok_username=' + encodeURIComponent(tiktokUsername))
        .then(response => response.json())
        .then(data => {
            // Assuming data.flashcards is an array of flashcards with collection_name, prompt, answer
            if (Array.isArray(data.flashcards)) {
                data.flashcards.forEach(flashcard => {
                    const { collection_name, prompt, answer } = flashcard;
                    if (!collections[collection_name]) {
                        collections[collection_name] = [];
                    }
                    collections[collection_name].push({ prompt, answer });
                });
                // Update the UI with the fetched data
                // Set currentCollection to one of the collections, e.g., the first one
                if (Object.keys(collections).length > 0) {
                    currentCollection = Object.keys(collections)[0];
                    document.getElementById('collectionTitle').textContent = currentCollection;
                    currentIndex = 0;
                    showingAnswer = false;
                    updateFlashcard();
                } else {
                    // No collections or flashcards found
                    currentCollection = '';
                    document.getElementById('collectionTitle').textContent = 'No Collections';
                    updateFlashcard();
                }
            } else {
                console.error('Invalid data format for flashcards.');
            }
        })
        .catch(error => {
            console.error('Error fetching flashcards:', error);
        });
    }

    function updateFlashcardIndex(fIndex, fLength) {
        document.getElementById("flashcardIndex").innerText = fIndex.toString() + " / " + fLength.toString()
    }

    function updateFlashcard() {
        const flashcards = collections[currentCollection] || [];
        const flashcardPrompt = document.getElementById('flashcardPrompt');
        const flashcardAnswer = document.getElementById('flashcardAnswer');
        const flashcardElement = document.getElementById('flashcard');

        if (flashcards.length === 0) {
            flashcardPrompt.textContent = "No flashcards in this collection.";
            flashcardAnswer.textContent = "";
            flashcardElement.classList.remove('is-flipped');
            return;
        }

        flashcardPrompt.textContent = flashcards[currentIndex].prompt;
        flashcardAnswer.textContent = flashcards[currentIndex].answer.split('|')[0];

        // Ensure both faces have the same height
        setEqualCardHeight();

        if (showingAnswer) {
            flashcardElement.classList.add('is-flipped');
        } else {
            flashcardElement.classList.remove('is-flipped');
        }
        updateFlashcardIndex(currentIndex + 1, flashcards.length)
        // Reset Timer and Users Answered
        resetTimer();
        usersAnsweredThisRound.clear();
    }

    function setEqualCardHeight() {
        const frontFace = document.querySelector('.flashcard-front');
        const backFace = document.querySelector('.flashcard-back');

        // Reset heights
        frontFace.style.height = 'auto';
        backFace.style.height = 'auto';

        // Get the heights
        const frontHeight = frontFace.offsetHeight;
        const backHeight = backFace.offsetHeight;

        // Set both to the maximum height
        const maxHeight = Math.max(frontHeight, backHeight);
        frontFace.style.height = backFace.style.height = maxHeight + 'px';
    }

    function revealAnswer() {
        removeLeaderboardWaveEffect();
        resetTimer();
        showingAnswer = !showingAnswer;
        const flashcardElement = document.getElementById('flashcard');
        flashcardElement.classList.toggle('is-flipped');
    }

    function jumpToFlashcard(newIndex) {
        const flashcards = collections[currentCollection] || [];
        const totalLength = flashcards.length;
        if (totalLength === 0) return;

        if (newIndex >= 1 && newIndex <= totalLength) {
            currentIndex = newIndex - 1;
            if (showingAnswer) {
                revealAnswer();
                setTimeout(() => {
                    jumpToFlashcard(newIndex);
                }, 500)
                return;
            }
            showingAnswer = false; // Reset showingAnswer
            updateFlashcard();
        }
    }

    function prevFlashcard() {
        removeLeaderboardWaveEffect();
        if (showingAnswer) {
            revealAnswer();
            setTimeout(() => {
                prevFlashcard();
            }, 500)
            return;
        }
        const flashcards = collections[currentCollection] || [];
        if (flashcards.length === 0) return;
        if (currentIndex > 0) {
            currentIndex--;
            showingAnswer = false;
            updateFlashcard();
        }
    }

    function nextFlashcard() {
        removeLeaderboardWaveEffect();
        if (showingAnswer) {
            revealAnswer();
            setTimeout(() => {
                nextFlashcard();
            }, 500)
            return;
        }
        const flashcards = collections[currentCollection] || [];
        if (flashcards.length === 0) return;
        if (currentIndex < flashcards.length - 1) {
            currentIndex++;
            showingAnswer = false;
            updateFlashcard();
        }
    }

    function openSidePanel() {
        document.getElementById("sidepanel").style.width = "300px";
    }

    function closeSidePanel() {
        document.getElementById("sidepanel").style.width = "0";
    }

    function selectCollection(name) {
        currentCollection = name;
        currentIndex = 0;
        showingAnswer = false;
        document.getElementById('collectionTitle').textContent = name;
        updateFlashcard();
        closeSidePanel();
    }

    function addCollection() {
        const name = document.getElementById('newCollectionName').value.trim();
        if (name && !collections[name]) {
            collections[name] = [];
            document.getElementById('newCollectionName').value = '';

            // Send data to the collection endpoint
            const data = {
                tiktok_username: tiktokUsername,
                collection_name: name,
                loaddate: new Date().toISOString()
            };

            fetch('https://cc-contexto-d01a6bbfa039.herokuapp.com/add-flashcard-collection', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                // Optionally handle the response
                console.log('Collection added successfully.');
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });
        }
    }

    function addFlashcard() {
        const prompt = document.getElementById('newPrompt').value.trim();
        const answer = document.getElementById('newAnswer').value.trim();
        if (prompt && answer) {
            collections[currentCollection].push({ prompt, answer });
            document.getElementById('newPrompt').value = '';
            document.getElementById('newAnswer').value = '';
            updateFlashcard();

            // Send data to the flashcard endpoint
            const data = {
                tiktok_username: tiktokUsername,
                collection_name: currentCollection,
                prompt: prompt,
                answer: answer,
                loaddate: new Date().toISOString()
            };

            fetch('https://cc-contexto-d01a6bbfa039.herokuapp.com/add-flashcard', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                // Optionally handle the response
                console.log('Flashcard added successfully.');
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });
        }
    }

    // Timer Functions
    function startRound() {
        // Update timer duration from input
        const roundDurationInput = document.getElementById('roundDurationInput');
        const newDuration = parseInt(roundDurationInput.value);
        if (!isNaN(newDuration) && newDuration > 0) {
            timerDuration = newDuration;
        } else {
            timerDuration = 90; // Default to 90 seconds if input is invalid
            roundDurationInput.value = 90;
        }
        resetTimer();
        startTimer();
    }

    function startTimer() {
        addLeaderboardWaveEffect();
        const timerDisplay = document.getElementById('timerDisplay');
        timerDisplay.style.color = "#5bc25f";
        remainingTime = timerDuration;//
        timerDisplay.textContent = remainingTime;
        timerDisplay.style.display = 'block';
        roundStartTime = Date.now();
        usersAnsweredThisRound.clear(); // Clear users who have answered in the previous round
        roundActive = true; // Round is now active

        timer = setInterval(() => {
            const elapsedSeconds = Math.floor((Date.now() - roundStartTime) / 1000);
            remainingTime = timerDuration - elapsedSeconds;

            if (remainingTime > 0) {
                timerDisplay.textContent = remainingTime;
            } else {
                timerDisplay.textContent = '0';
                clearInterval(timer);
                removeLeaderboardWaveEffect();
                timerDisplay.style.color = "#000000";
                roundActive = false; // Round has ended
            }
        }, 1000);
    }

    function resetTimer() {
        clearInterval(timer);
        remainingTime = timerDuration;
        const timerDisplay = document.getElementById('timerDisplay');
        timerDisplay.textContent = remainingTime;
        timerDisplay.style.display = 'none';
        roundStartTime = null;
        roundActive = false;
    }

    // Comments Functionality
    function simulateComments() {
        var num = Math.floor(Math.random() * testComment.comments.length)
        const randomComment = testComment.comments[num];
        const randomImage = testComment.photoUrl[num];
        const randomUser = testComment.username[num];
        addComment(randomImage, randomUser, randomComment);
    }

    window.addEventListener('addCommentEvent', function(event) {
        console.log(event)
        addComment(event.detail.photoUrl, event.detail.username, event.detail.commentText)
    });

    function addComment(photoUrl, username, commentText) {
        const commentsSection = document.getElementById('commentsSection');

        const commentDiv = document.createElement('div');
        commentDiv.className = 'comment new-comment';

        const img = document.createElement('img');
        img.src = photoUrl;
        img.alt = username + "'s profile picture";

        const commentContent = document.createElement('div');
        commentContent.className = 'comment-text';

        const usernameSpan = document.createElement('span');
        usernameSpan.className = 'username';
        usernameSpan.textContent = username + ': ';

        const commentSpan = document.createElement('span');
        commentSpan.textContent = commentText;

        commentContent.appendChild(usernameSpan);
        commentContent.appendChild(commentSpan);

        commentDiv.appendChild(img);
        commentDiv.appendChild(commentContent);

        // Insert the new comment at the top
        commentsSection.insertBefore(commentDiv, commentsSection.firstChild);

        // Check if the comment is correct
        checkCommentForAnswer(username, photoUrl, commentText);

        // Remove the comment after 1 second
        setTimeout(() => {
            commentDiv.style.opacity = '0';
            setTimeout(() => {
                commentsSection.removeChild(commentDiv);
            }, 500); // Allow time for opacity transition
        }, 1000);
    }

    // function checkCommentForAnswer(username, photoUrl, commentText) {
    //     if (roundActive && remainingTime > 0) {
    //         const flashcards = collections[currentCollection] || [];
    //         if (flashcards.length === 0) return;

    //         const currentAnswer = flashcards[currentIndex].answer.trim().toLowerCase();
    //         if (commentText.trim().toLowerCase() === currentAnswer) {
    //             if (usersAnsweredThisRound.has(username)) {
    //                 // User has already answered in this round; do not award more points
    //                 return;
    //             }
    //             const elapsedSeconds = Math.floor((Date.now() - roundStartTime) / 1000);
    //             const points = Math.max(0, Math.floor(1000 - (elapsedSeconds * (1000 / timerDuration))));
    //             updateLeaderboard(username, photoUrl, points);
    //             usersAnsweredThisRound.add(username); // Mark user as having answered this round
    //         }
    //     }
    // }

    function checkCommentForAnswer(username, photoUrl, commentText) {
        if (roundActive && remainingTime > 0) {
            const flashcards = collections[currentCollection] || [];
            if (flashcards.length === 0) return;

            const currentAnswer = flashcards[currentIndex].answer.trim().toLowerCase();
            const acceptableAnswers = currentAnswer.split('|').map(ans => ans.trim().toLowerCase());

            if (acceptableAnswers.includes(commentText.trim().toLowerCase())) {
                if (usersAnsweredThisRound.has(username)) {
                    // User has already answered in this round; do not award more points
                    return;
                }
                const elapsedSeconds = Math.floor((Date.now() - roundStartTime) / 1000);
                const points = Math.max(0, Math.floor(1000 - (elapsedSeconds * (1000 / timerDuration))));
                updateLeaderboard(username, photoUrl, points);
                usersAnsweredThisRound.add(username); // Mark user as having answered this round
            }
        }
    }


    // Leaderboard Functions
    function displayLeaderboard() {
        const leaderboardElement = document.getElementById('leaderboard');
        leaderboardElement.innerHTML = '<h2 id="leaderboardTextContainer">' + 
            '<span>L</span><span>e</span><span>a</span><span>d</span><span>e</span><span>r</span><span>b</span><span>o</span><span>a</span><span>r</span><span>d</span>' +
        '</h2>';
        leaderboardData.sort((a, b) => b.points - a.points);
        leaderboardData.forEach(user => {
            const userDiv = document.createElement('div');
            userDiv.className = 'user';

            const img = document.createElement('img');
            img.src = user.photoUrl;
            img.alt = user.username + "'s profile picture";

            const userInfo = document.createElement('div');
            userInfo.className = 'user-info';

            const usernameDiv = document.createElement('div');
            usernameDiv.className = 'username';
            usernameDiv.textContent = user.username;

            const pointsDiv = document.createElement('div');
            pointsDiv.className = 'points';
            pointsDiv.textContent = user.points + ' points';

            userInfo.appendChild(usernameDiv);
            userInfo.appendChild(pointsDiv);

            userDiv.appendChild(img);
            userDiv.appendChild(userInfo);

            leaderboardElement.appendChild(userDiv);

            addLeaderboardWaveEffect();
        });
    }

    function updateLeaderboard(username, photoUrl, points) {
        const existingUser = leaderboardData.find(user => user.username === username);
        if (existingUser) {
            existingUser.points += points; // Add new points to existing points
        } else {
            leaderboardData.push({ username, photoUrl, points });
        }
        displayLeaderboard();
    }

    function clearLeaderboard() {
        leaderboardData = [];
        displayLeaderboard();
    }

    function simulateUserAnswer() {
        // Simulate a correct answer from a random user
        const usernames = ["Bob", "Charlie", "Eve", "Dana", "Alice"];
        const photoUrls = ["data:image/jpeg;base64,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",
                    "https://i0.wp.com/picjumbo.com/wp-content/uploads/beautiful-autumn-nature-with-a-river-in-the-middle-of-the-forest-free-image.jpeg?w=600&quality=80",
                    "https://media.istockphoto.com/id/1170493702/photo/portrait-of-smiling-young-woman-looking-at-camera.jpg?s=612x612&w=0&k=20&c=2nS__ZCBvTLdbI96NDKLeaVNYcenc8Pg3o01PswHcXk=",
                    "https://media.istockphoto.com/id/1276778124/photo/beautiful-senior-woman-outdoors-in-the-city.jpg?s=612x612&w=0&k=20&c=J5iLFEF_pcztXZzCeYsphhjziA9VM9d7UZGAwNvcZu0=",
                    "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSpS4CstMwyiA-3QsCcpENY5DtlQM51AGxpag&s"];
        var num = Math.floor(Math.random() * usernames.length);
        const randomUsername = usernames[num];
        const randomUrl = photoUrls[num]
        const flashcards = collections[currentCollection] || [];
        if (flashcards.length === 0) return;
        addComment(randomUrl, randomUsername, flashcards[currentIndex].answer);
    }

    // Manage Collections Modal Functions
    function openManageCollectionsModal() {
        const modal = document.getElementById('manageCollectionsModal');
        const list = document.getElementById('collectionsModalList');
        list.innerHTML = '';
        console.log(collections)
        for (let collectionName in collections) {
            const li = document.createElement('li');
            li.textContent = collectionName;

            const openBtn = document.createElement('button');
            openBtn.textContent = 'Open';
            openBtn.onclick = function() {
                selectCollection(collectionName);
                closeManageCollectionsModal();
            };

            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'Delete';
            if (collectionName === "Incohearent") {
                deleteBtn.disabled = true;
            }
            deleteBtn.onclick = function() {
                deleteCollection(collectionName);
                openManageCollectionsModal(); // Refresh the list
            };

            const btnContainer = document.createElement('div');
            btnContainer.appendChild(openBtn);
            btnContainer.appendChild(deleteBtn);

            li.appendChild(btnContainer);
            list.appendChild(li);
        }

        modal.style.display = 'block';
    }

    function closeManageCollectionsModal() {
        const modal = document.getElementById('manageCollectionsModal');
        modal.style.display = 'none';
    }

    function deleteCollection(name) {
        if (collections.hasOwnProperty(name)) {
            delete collections[name];
            if (currentCollection === name) {
                currentCollection = Object.keys(collections)[0] || '';
                updateFlashcard();
            }

            // Send data to the remove collection endpoint
            const data = {
                tiktok_username: tiktokUsername,
                collection_name: name,
                loaddate: new Date().toISOString()
            };

            fetch('https://cc-contexto-d01a6bbfa039.herokuapp.com/remove-flashcard-collection', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                // Optionally handle the response
                console.log('Collection removed successfully.');
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });
        }
    }

    // Manage Flashcards Modal Functions
    function openManageFlashcardsModal() {
        const modal = document.getElementById('manageFlashcardsModal');
        const list = document.getElementById('flashcardsModalList');
        const currentCollectionFlashcards = collections[currentCollection] || [];

        document.getElementById('currentCollectionName').textContent = currentCollection;
        list.innerHTML = '';

        currentCollectionFlashcards.forEach((card, index) => {
            const li = document.createElement('li');
            li.textContent = card.prompt;

            const deleteBtn = document.createElement('button');
            if (currentCollection === "Incohearent") {
                deleteBtn.disabled = true;
            }
            deleteBtn.textContent = 'Delete';
            deleteBtn.onclick = function() {
                deleteFlashcard(index);
                openManageFlashcardsModal(); // Refresh the list
            };

            li.appendChild(deleteBtn);
            list.appendChild(li);
        });

        // Clear previous messages
        document.getElementById('jsonMessage').textContent = '';
        document.getElementById('jsonInput').value = '';

        modal.style.display = 'block';
    }

    function closeManageFlashcardsModal() {
        const modal = document.getElementById('manageFlashcardsModal');
        modal.style.display = 'none';
    }

    function removeLeaderboardWaveEffect() {
        document.getElementById("leaderboardTextContainer").classList.remove("wavy-text");
    }

    function addLeaderboardWaveEffect() {
        document.getElementById("leaderboardTextContainer").classList.add("wavy-text");
    }

    function deleteFlashcard(index) {
        const removedCard = collections[currentCollection][index];
        collections[currentCollection].splice(index, 1);
        if (currentIndex >= collections[currentCollection].length) {
            currentIndex = collections[currentCollection].length - 1;
        }
        updateFlashcard();

        // Send data to the remove flashcard endpoint
        const data = {
            tiktok_username: tiktokUsername,
            collection_name: currentCollection,
            prompt: removedCard.prompt,
            answer: removedCard.answer,
            loaddate: new Date().toISOString()
        };

        fetch('https://cc-contexto-d01a6bbfa039.herokuapp.com/remove-flashcard', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            // Optionally handle the response
            console.log('Flashcard removed successfully.');
        })
        .catch(error => {
            console.error('There was a problem with the fetch operation:', error);
        });
    }

    // Upload Flashcards from JSON
    function uploadFlashcardsFromJSON() {
        const jsonInput = document.getElementById('jsonInput').value.trim();
        const messageDiv = document.getElementById('jsonMessage');

        try {
            const parsedData = JSON.parse(jsonInput);

            if (!Array.isArray(parsedData)) {
                throw new Error("JSON must be an array of objects.");
            }

            const validFlashcards = parsedData.filter(item => {
                return item.prompt && item.answer;
            });

            if (validFlashcards.length === 0) {
                throw new Error("No valid flashcards found in the JSON.");
            }

            collections[currentCollection] = collections[currentCollection].concat(validFlashcards);
            updateFlashcard();
            openManageFlashcardsModal(); // Refresh the list

            // Send data to the batch endpoint
            const data = {
                tiktok_username: tiktokUsername,
                collection_name: currentCollection,
                flashcards: validFlashcards,
                loaddate: new Date().toISOString()
            };

            fetch('https://cc-contexto-d01a6bbfa039.herokuapp.com/add-flashcard-batch', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                // Optionally handle the response
                console.log('Flashcards batch added successfully.');
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });

            messageDiv.textContent = "Flashcards uploaded successfully!";
            messageDiv.className = "success-message";
            document.getElementById('jsonInput').value = '';
        } catch (error) {
            messageDiv.textContent = "Error: " + error.message;
            messageDiv.className = "error-message";
        }
    }

    document.getElementById("flashcardIndex").addEventListener('click', function() {
        var flashcardIndexDiv = document.getElementById("flashcardIndex");
        var currentText = flashcardIndexDiv.innerText;
        var parts = currentText.split(' / ');
        var currentIndexText = parts[0];
        var totalLengthText = parts[1];
        var totalLength = parseInt(totalLengthText);

        // If there are no flashcards, do nothing
        if (isNaN(totalLength) || totalLength <= 0) {
            return;
        }

        // Create an input field
        var input = document.createElement('input');
        input.classList.add('no-arrows')
        input.type = 'number';
        input.min = 1;
        input.max = totalLength;
        input.value = currentIndexText;
        input.style.width = '25px'; // Adjust width as needed

        // Replace the index number with the input field
        flashcardIndexDiv.innerHTML = ''; // Clear the div
        flashcardIndexDiv.appendChild(input);
        flashcardIndexDiv.appendChild(document.createTextNode(' / ' + totalLengthText));

        input.focus();

        // Function to finalize input processing
        function finalizeInput() {
            // Handle the input value
            var newIndex = parseInt(input.value);
            if (isNaN(newIndex) || newIndex < 1 || newIndex > totalLength) {
                // Invalid input, reset to current index
                newIndex = currentIndex + 1; // currentIndex is 0-based
            }
            // Jump to the new flashcard
            jumpToFlashcard(newIndex);
        }

        input.addEventListener('blur', function() {
            finalizeInput();
        });

        // Also handle the Enter and Escape keys
        input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault(); // Prevent form submission
                input.blur();
            }
        });
    });


    // Close modals when clicking outside of them
    window.onclick = function(event) {
        const manageCollectionsModal = document.getElementById('manageCollectionsModal');
        const manageFlashcardsModal = document.getElementById('manageFlashcardsModal');

        if (event.target === manageCollectionsModal) {
            closeManageCollectionsModal();
        } else if (event.target === manageFlashcardsModal) {
            closeManageFlashcardsModal();
        }
    };

    // Initialize the leaderboard
    displayLeaderboard();

    // Check if tiktokUsername is stored in localStorage
    window.onload = function() {
        const storedUsername = localStorage.getItem('tiktokUsername');
        if (storedUsername) {
            tiktokUsername = storedUsername;
            document.getElementById('tiktokUsernameInput').value = tiktokUsername;
            disableInputs(false);
            fetchCollectionsAndFlashcards();
        }
    };
</script>

</body>
</html>
